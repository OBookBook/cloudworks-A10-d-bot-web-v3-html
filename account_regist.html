<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>アカウント登録</title>
  <link rel="stylesheet" href="./css/admin-dashboard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="layout">
    <div class="sidebar">
        <h2>設定メニュー</h2>
        <!-- ゲストモード用メニュー -->
        <!-- <a href="tweet_japanese.html">日本人いいね</a> -->
        <!-- <a href="./tweet_japanese.html">Twitter拡散サービス(日本人いいね)</a> -->
        <a href="./tweet_sensyuken.html">選手権いいね</a>
        <a href="./tweet.html">いいね・ﾌﾞｯｸﾏｰｸ</a>
        <a href="./account_list.html">Xアカウント一覧</a>
        <a href="./account_regist.html">Xアカウント登録</a>
        <a href="./account_regist2.html">Xアカウント登録(貸出)</a>
        <a href="./password.html">パスワード変更</a>
        <a href="./upload.html?type=m">動画アップロード</a>
        <a href="./upload.html?type=p">画像アップロード</a>
        <a href="./user_master.html">AI API設定</a>
        <a href="./user_list.html">ユーザー編集(管理者)</a>
        <a href="./login.html">ログアウト</a>
      </div>

    <div class="main">
   <h2 class="tx-white">新規Xアカウント登録</h2>
   <form method="POST" action="?">

    <div class="input-group">
        <input type="text" id="new_name" name="new_name" placeholder="名前" required>
    </div>
    <div class="input-group">
        <input type="text" id="new_login_id" name="new_login_id" placeholder="ログインID" required>
    </div>
    <div class="input-group">
        <input type="text" id="new_login_pass" name="new_login_pass" placeholder="ログインパス">
    </div>

    <!-- チェックボックス (通常モード用) -->
        <div class="input-group">
            <input type="text" name="new_client_id" placeholder="ClientID">
        </div>
        <div class="input-group">
            <input type="text" name="new_client_secret" placeholder="ClientSecret">
        </div>

    <!--
    <div class="input-group">
        <input type="text" name="new_bearer_token" placeholder="BearerToken">
    </div>
    <div class="input-group">
        <input type="text" name="new_refresh_token" placeholder="RefreshToken">
    </div>
    -->

    <div class="input-group" checkbox-group">
        <label>
            <input type="checkbox" name="new_enable" value="1" checked>有効
        </label><br>

        <?php if (isset($_SESSION['post_enable']) && $_SESSION['post_enable'] == 1): ?>
        <label>
            <input type="checkbox" name="new_post_enable" value="1" checked>ポスト機能
        </label><br>
        <?php endif; ?>

        <?php if (isset($_SESSION['like_enable']) && $_SESSION['like_enable'] == 1): ?>
        <label>
            <input type="checkbox" name="new_like_enable" value="1" checked>いいね機能
        </label><br>
        <?php else: ?>
            <label>
            <input type="hidden" name="new_like_enable" value="1" checked>
        </label><br>
        <?php endif; ?>

        <?php if (isset($_SESSION['bookmark_enable']) && $_SESSION['bookmark_enable'] == 1): ?>
            <label>
            <input type="checkbox" name="new_bookmark_enable" value="1" checked>ブックマーク機能
            </label><br>
        <?php else: ?>
            <label>
            <input type="hidden" name="new_bookmark_enable" value="1" checked>
        </label><br>
        <?php endif; ?>

        <?php if (isset($_SESSION['reply_enable']) && $_SESSION['reply_enable'] == 1): ?>
            <label>
            <input type="checkbox" name="new_reply_enable" value="1"  checked>リプライ機能
        </label><br>
        <?php endif; ?>

        <?php if (isset($_SESSION['repost_enable']) && $_SESSION['repost_enable'] == 1): ?>
        <label>
            <input type="checkbox" name="new_repost_enable" value="1" checked>リポスト機能
        </label><br>
        <?php endif; ?>

        <?php if (isset($_SESSION['check_enable']) && $_SESSION['check_enable'] == 1): ?>
        <label>
            <input type="checkbox" name="new_search_enable" value="0">監視実施
        </label><br>

        <div class="input-group">
        <label for="check_interval">監視周期(分):</label>
        <input type="number" id="check_interval" name="check_interval" min="5" max="6000" step="1" value="60" style="width: 50px;">
        </div>

        <?php endif; ?>

        <label>
            <input type="checkbox" name="new_proxy_enable" value="0">プロキシ
        </label><br>
        <input type="text" name="new_proxy_url" placeholder="プロキシURL">
        <br>
    </div>

    <div class="input-group">
        <?php if ((isset($_SESSION['like_enable']) && $_SESSION['like_enable'] == 1) ||
          (isset($_SESSION['bookmark_enable']) && $_SESSION['bookmark_enable'] == 1)): ?>
            <label>
            <input type="checkbox" name="new_paid" value="1" checked>有料アカウント
            </label><br>
        <?php endif; ?>

        <?php if (isset($_SESSION['like_enable']) && $_SESSION['like_enable'] == 1): ?>
            <label>
                <input type="checkbox" name="new_paid_like" value="1" checked>有料API(いいね)
            </label><br>
        <?php endif; ?>

        <?php if (isset($_SESSION['bookmark_enable']) && $_SESSION['bookmark_enable'] == 1): ?>
            <label>
                <input type="checkbox" name="new_paid_bookmark" value="1" checked>有料API(ブックマーク)
            </label><br>
        <?php endif; ?>
    </div>

        <div class="input-group">
            <input type="text" id="new_dmm_id" name="new_dmm_id" placeholder="DMM ID">
        </div>

        <br>
        【メディアポスト関連】
        <br>
        <div class="input-group">
            <input type="text" name="new_api_key" placeholder="ApiKey">
        </div>
        <div class="input-group">
            <input type="text" name="new_api_key_secret" placeholder="ApiKeySecret">
        </div>

        <br>
        【ポスト予約設定】
        <br>
        <label>
            <input type="checkbox" name="reserve1_enable" value="1">時間帯１
            <input type="text" id="reserve1_start_hour" name="reserve1_start_hour" class="short" placeholder="開始" > ～
            <input type="text" id="reserve1_end_hour" name="reserve1_end_hour" class="short" placeholder="終了" > 時　
            <input type="text" id="reserve1_count" name="reserve1_count" class="short" placeholder="" > 回
            <?php if (isset($_SESSION['ai_enable']) && $_SESSION['ai_enable'] == 1): ?>
                <input type="checkbox" name="reserve1_ai" value="1">AIｺﾒﾝﾄ
                <?php endif; ?>
            </label><br>
        <label>
            <input type="checkbox" name="reserve2_enable" value="1">時間帯２
            <input type="text" id="reserve2_start_hour" name="reserve2_start_hour" class="short" placeholder="開始" > ～
            <input type="text" id="reserve2_end_hour" name="reserve2_end_hour" class="short" placeholder="終了" > 時　
            <input type="text" id="reserve2_count" name="reserve2_count" class="short" placeholder="" > 回
            <?php if (isset($_SESSION['ai_enable']) && $_SESSION['ai_enable'] == 1): ?>
                <input type="checkbox" name="reserve2_ai" value="1">AIｺﾒﾝﾄ
            <?php endif; ?>
        </label><br>
        <label>
            <input type="checkbox" name="reserve3_enable" value="1">時間帯３
            <input type="text" id="reserve3_start_hour" name="reserve3_start_hour" class="short" placeholder="開始" > ～
            <input type="text" id="reserve3_end_hour" name="reserve3_end_hour" class="short" placeholder="終了" > 時　
            <input type="text" id="reserve3_count" name="reserve3_count" class="short" placeholder="" > 回
            <?php if (isset($_SESSION['ai_enable']) && $_SESSION['ai_enable'] == 1): ?>
                <input type="checkbox" name="reserve3_ai" value="1">AIｺﾒﾝﾄ
            <?php endif; ?>
        </label><br>
        <label>
            <input type="checkbox" name="reserve4_enable" value="1">時間帯４
            <input type="text" id="reserve4_start_hour" name="reserve4_start_hour" class="short" placeholder="開始" > ～
            <input type="text" id="reserve4_end_hour" name="reserve4_end_hour" class="short" placeholder="終了" > 時　
            <input type="text" id="reserve4_count" name="reserve4_count" class="short" placeholder="" > 回
            <?php if (isset($_SESSION['ai_enable']) && $_SESSION['ai_enable'] == 1): ?>
                <input type="checkbox" name="reserve4_ai" value="1">AIｺﾒﾝﾄ
            <?php endif; ?>
        </label><br>
        <br>

        <?php if (isset($_SESSION['ai_enable']) && $_SESSION['ai_enable'] == 1): ?>
        <br>
        【AIコメント設定】
        <br>

        <label>
            <input type="radio" name="ai_mode" value="0" onclick="filterPresets()" checked> なし
        </label>
        <label>
            <input type="radio" name="ai_mode" value="1" onclick="filterPresets()" checked> 自由モード
        </label>
        <label>
            <input type="radio" name="ai_mode" value="2" onclick="filterPresets()"> 裏垢女子モード
        </label>
        <label>
            <input type="radio" name="ai_mode" value="3" onclick="filterPresets()"> トレンドモード
        </label>

        <br>
        <input type="checkbox" name="ai_post_enable" value="1">AIポスト<br>
        プロンプト設定

        <select id="post_preset_select" onchange="loadPresetText_post()">
            <option value="">選択してください</option>
            <?php foreach ($presets as $preset): ?>
                <?php if ($preset['mode'] === 'post'):  ?>
                <!-- モードが自由の場合、preset['type'] が '自由' のものだけ表示 -->
                    <option value="<?= htmlspecialchars($preset['prompt'], ENT_QUOTES, 'UTF-8') ?>"
                    class="preset-option"
                    data-type="<?= htmlspecialchars($preset['type'], ENT_QUOTES, 'UTF-8') ?>"
                    data-example="<?= htmlspecialchars($preset['example'], ENT_QUOTES, 'UTF-8') ?>">
                    <?= htmlspecialchars($preset['name'], ENT_QUOTES, 'UTF-8') ?>
                    </option>
                <?php endif; ?>
            <?php endforeach; ?>
        </select>

        <br>
        <textarea id="ai_post_prompt" name="ai_post_prompt" cols="80" rows="5" maxlength="1000"
        style="width: 100%; height: 200px; resize: vertical; overflow-y: auto;"></textarea>
        <textarea id="ai_post_example" name="ai_post_example" cols="80" rows="5" maxlength="2000"
        style="width: 100%; height: 200px; resize: vertical; overflow-y: auto;"></textarea>
        <textarea id="ai_trend_prompt" name="ai_trend_prompt" cols="80" rows="5" maxlength="1000"
        style="width: 100%; height: 200px; resize: vertical; overflow-y: auto;"></textarea>
        <br>

        <input type="checkbox" name="ai_reply_enable" value="1">AIリプライ<br>
        プロンプト設定
        <select id="reply_preset_select" onchange="loadPresetText_reply()">
            <option value="">選択してください</option>
            <?php foreach ($presets as $preset): ?>
                <?php if ($preset['mode'] === 'reply'):  ?>

                    <!-- モードが自由の場合、preset['type'] が '自由' のものだけ表示 -->
                    <option value="<?= htmlspecialchars($preset['prompt'], ENT_QUOTES, 'UTF-8') ?>"
                    class="preset-option"
                    data-type="<?= htmlspecialchars($preset['type'], ENT_QUOTES, 'UTF-8') ?>"
                    data-example="<?= htmlspecialchars($preset['example'], ENT_QUOTES, 'UTF-8') ?>">
                    <?= htmlspecialchars($preset['name'], ENT_QUOTES, 'UTF-8') ?>
                    </option>
                <?php endif; ?>
            <?php endforeach; ?>
        </select>
        <br>
        <textarea id="ai_reply_prompt" name="ai_reply_prompt" cols="80" rows="5" maxlength="1000"
        style="width: 100%; height: 200px; resize: vertical; overflow-y: auto;"></textarea>
        <textarea id="ai_reply_example" name="ai_reply_example" cols="80" rows="5" maxlength="2000"
        style="width: 100%; height: 200px; resize: vertical; overflow-y: auto;"></textarea>
        <br>
        <?php endif; ?>
        <button type="submit">登録</button>
        </div>
    </form>
</form>
</div>
</div>

<script>
function loadPresetText_post() {
    var select = document.getElementById("post_preset_select");
    var selectedOption = select.options[select.selectedIndex]; // 選択されたオプション

    // ラジオボタン（ai_mode）の選択状態を取得
    var selectedMode = document.querySelector('input[name="ai_mode"]:checked').value;

    if(selectedMode === "3")
    {
        // 選択されたオプションの value を ai_trend_prompt に設定
        var promptTextArea = document.getElementById("ai_trend_prompt");
        promptTextArea.value = selectedOption.value;
    }
    else{
        // 選択されたオプションの value を ai_post_prompt に設定
        var promptTextArea = document.getElementById("ai_post_prompt");
        promptTextArea.value = selectedOption.value;

        // 選択されたオプションの data-example を ai_post_example に設定
        var exampleTextArea = document.getElementById("ai_post_example");
        exampleTextArea.value = selectedOption.dataset.example || "";
    }

}

function loadPresetText_reply() {
    var select = document.getElementById("reply_preset_select");
    var selectedOption = select.options[select.selectedIndex]; // 選択されたオプション
    var promptTextArea = document.getElementById("ai_reply_prompt");
    var exampleTextArea = document.getElementById("ai_reply_example");

    // 選択されたオプションの value を ai_post_prompt に設定
    promptTextArea.value = selectedOption.value;

    // 選択されたオプションの data-example を ai_post_example に設定
    exampleTextArea.value = selectedOption.dataset.example || "";

}

</script>

<script>
// AIモードが変更された時に実行される関数
function filterPresets() {
    const selectedMode = document.querySelector('input[name="ai_mode"]:checked').value;
    const options = document.querySelectorAll('.preset-option');

    // 各テキストエリア要素を取得
    const postPrompt = document.getElementById("ai_post_prompt");
    const postExample = document.getElementById("ai_post_example");
    const replyPrompt = document.getElementById("ai_reply_prompt");
    const replyExample = document.getElementById("ai_reply_example");
    const postPresetSelect = document.getElementById("post_preset_select");
    const replyPresetSelect = document.getElementById("reply_preset_select");

    const trendPrompt = document.getElementById("ai_trend_prompt");

    // 存在確認（エラー回避）
    if (!postPrompt || !postExample || !replyPrompt || !replyExample) {
        console.error("対象の要素が見つかりません");
        return;
    }

    // テキストエリアの値をクリア
    postPrompt.value = '';
    postExample.value = '';
    replyPrompt.value = '';
    replyExample.value = '';
    trendPrompt.value = '';

    // プリセットオプションの表示切り替え
    options.forEach(option => {
        const presetType = option.dataset.type;
        if (selectedMode === "1" && presetType === '自由') {
            option.style.display = 'block';
        } else if (selectedMode === "2" && presetType === '裏垢') {
            option.style.display = 'block';
        } else if (selectedMode === "3" && presetType === 'トレンド') {
            option.style.display = 'block';
        } else {
            option.style.display = 'none';
        }
    });

    // 最初の選択肢をリセット
    const postSelect = document.getElementById("post_preset_select");
    if (postSelect) postSelect.value = "";

    // "なし" を選んだ場合、すべて非表示
    if (selectedMode === "0") {
        postPrompt.style.display = 'none';
        postExample.style.display = 'none';
        replyPrompt.style.display = 'none';
        replyExample.style.display = 'none';
        postPresetSelect.style.display = 'none';
        replyPresetSelect.style.display = 'none';
        trendPrompt.style.display = 'none';
    }
    // "自由モード" の場合、ai_reply_prompt だけ非表示
    else if (selectedMode === "1") {
        postPrompt.style.display = 'block';
        postExample.style.display = 'none';
        replyPrompt.style.display = 'none';
        replyExample.style.display = 'none';
        postPresetSelect.style.display = 'block';
        replyPresetSelect.style.display = 'block';
        trendPrompt.style.display = 'none';
    }
    // "裏垢女子モード" の場合、すべて表示
    else if (selectedMode === "2") {
        postPrompt.style.display = 'block';
        postExample.style.display = 'block';
        replyPrompt.style.display = 'block';
        replyExample.style.display = 'block';
        postPresetSelect.style.display = 'block';
        replyPresetSelect.style.display = 'block';
        trendPrompt.style.display = 'none';
    }
    // "トレンドモード" の場合、トレンドプロンプトのみ表示
    else if (selectedMode === "3") {
        postPrompt.style.display = 'none';
        postExample.style.display = 'none';
        replyPrompt.style.display = 'none';
        replyExample.style.display = 'none';
        postPresetSelect.style.display = 'block';
        replyPresetSelect.style.display = 'none';
        trendPrompt.style.display = 'block';
    }
}

// ページが読み込まれたときにフィルタリングを実行
window.onload = function() {
    filterPresets(); // 画面が起動したときにフィルタリングを呼び出す
};
</script>

<script>
    $(document).ready(function() {
        $("input[name='new_username']").on("input", function() {
            var username = $(this).val();
            // ユーザー名が空でない場合にチェック
            if (username) {
                $.get("./ajax/check_username.php", { username: username }, function(data) {
                    var result = JSON.parse(data);
                    if (result.exists) {
                        alert("このユーザー名は既に存在します。別のユーザー名を使用してください。");
                    }
                });
            }
        });
    });
</script>


<style>
    /* テキストボックスの幅を80%に設定 */
    .input-group input[type="text"] {
        width: 80%; /* 幅を80%に設定 */
        padding: 8px; /* パディングを追加 */
        font-size: 12px; /* フォントサイズを調整 */
        margin-bottom: 5px; /* ボックス間のスペース */
        box-sizing: border-box; /* パディングを含めた幅を計算 */
    }
</style>

<style>
    /* テキストボックスの幅を短く設定 */
    input[type="text"].short {
        width: 40px; /* 必要に応じて調整 */
    }
</style>

</body>
</html>
